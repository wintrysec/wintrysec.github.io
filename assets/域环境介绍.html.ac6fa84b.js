import{_ as t}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as i,c as n,a as e,b as a,d as r,e as s,r as d}from"./app.02b19a3e.js";const o="/assets/image-20230202104823800.909ff82b.png",c="/assets/image-20230202104945935.2ff42bb8.png",h="/assets/image-20230202105157761.c1bf12d6.png",l="/assets/image-20230202105348817.2422bc95.png",m="/assets/image-20230202111316343.6a418d6e.png",_="/assets/image-20230202111839200.a5a842a4.png",g="/assets/image-20230202111913087.1015f248.png",b="/assets/image-20230202121902853.8a9fd540.png",u="/assets/image-20230202122058126.8363f0e8.png",f="/assets/image-20230202122157893.ad931f13.png",D="/assets/image-20230202145546439.a9988d82.png",x="/assets/image-20230202171401580.d57746a0.png",v="/assets/image-20230202171217113.2526d112.png",y="/assets/image-20230202171322788.9c3874e4.png",C="/assets/image-20230203145700443.77ecbc26.png",z={},N=s('<h2 id="基本概念" tabindex="-1"><a class="header-anchor" href="#基本概念" aria-hidden="true">#</a> 基本概念</h2><h3 id="域" tabindex="-1"><a class="header-anchor" href="#域" aria-hidden="true">#</a> 域</h3><p>域（Domain）是一个有安全边界的计算机集合。</p><p>安全边界指在两个工作域中，一个域中的用户无法访问另一个域中的资源。</p><p>与工作组的 “松散会员制” 有所不同，“域” 是一个相对严格的组织。</p><p>用户想要访问域内资源，必须以合法身份登录域，用户对域内资源有什么样的权限取决于用户在域内的身份。</p><p>域控制器（Domain Controller，DC）是域中一台类似管理服务器的计算机，负责验证所有连入的计算机和用户。</p><p>在域内访问其他机器，不需要被访问机器的许可，但是要经过域控制器的审核。</p><p>域控制器（DC）中存在由这个域的账户、密码、属于这个域的计算机等信息构成的数据库。</p><p>当计算机连接到域时，DC首先会鉴别这个计算机是否属于本域，并验证账户和密码。</p><h4 id="_1-单域" tabindex="-1"><a class="header-anchor" href="#_1-单域" aria-hidden="true">#</a> 1）单域</h4><p>通常在小规模的公司中，建立一个域即可满足需求。</p><p>在一个域内，一般至少要两台域服务器，一台作为DC，另一台作为备份DC。</p><p>活动目录的数据库(包含用户账号信息)是存储在DC中的，如果DC瘫痪了，可用备份DC恢复域的正常使用。</p><h4 id="_2-父域和子域" tabindex="-1"><a class="header-anchor" href="#_2-父域和子域" aria-hidden="true">#</a> 2）父域和子域</h4><p>如果一个网络中划分多个域，第一个称为父域，其余的为子域。</p><p>例如一个大公司的各个分公司位于不同的地点，这时就要使用父子域。</p><p>父域和子域之间的信任关系是自动建立的，由 <code>Kerberos security protocol</code>完成。</p><p>子域的管理是独立的，比如子域有自己的安全策略（账号密码等策略），就不能用父域的账号登录子域。</p><h4 id="_3-域树" tabindex="-1"><a class="header-anchor" href="#_3-域树" aria-hidden="true">#</a> 3）域树</h4><p>域树（Tree）是多个域通过建立信任关系组成的集合。</p><p>一个域管理员只能管理本域，不能访问或管理其它域。两个域之间要互相访问，需要建立信任关系。</p><p>域树符合DNS域名空间的命名原则，而且是具有连续性，也就是子域的域名包含其父域的域名。</p><h4 id="_4-域森林" tabindex="-1"><a class="header-anchor" href="#_4-域森林" aria-hidden="true">#</a> 4）域森林</h4><p>域森林（Forest）是指多个<strong>域树</strong>通过建立信任关系组成的集合。</p>',25),S={href:"http://xn--abc-hb0e21g1vf3xixodxv0cysa044a591a.com",target:"_blank",rel:"noopener noreferrer"},A={href:"http://xn--abc-hb0e21gzcw5s5p0adw0c801b.net",target:"_blank",rel:"noopener noreferrer"},w=s('<p>所以域树abc.com和域树abc.net需要通过建立信任关系来组成域森林。</p><h4 id="_5-域名服务器" tabindex="-1"><a class="header-anchor" href="#_5-域名服务器" aria-hidden="true">#</a> 5）域名服务器</h4><p>域名服务器（Domian Name Server，DNS）是用于实现域名和与之相对的IP转换的服务器。</p><p>在域中的计算机是使用DNS来定位域控制器、服务器、以及其它计算机、网络服务的，所以域的名字就是DNS域的名字；</p><p>在内网渗透中，大都通过寻找DNS服务器来确定域控制器位置（它们通常配置在同一台机器上）。</p><h3 id="活动目录" tabindex="-1"><a class="header-anchor" href="#活动目录" aria-hidden="true">#</a> 活动目录</h3><p>活动目录（Active Directory，AD）是指域环境中提供目录服务的组件（win server 03之后内置）。</p><p>目录用于存储有关网络对象（用户、组、计算机、共享资源等）的信息。</p><p>目录服务帮助用户快捷、准确地从目录中找到其所需的信息服务，活动目录为企业提供了网络环境的集中式管理机制。</p><p>安装的AD的计算机即为DC，在活动目录中创建A账户一次，就能在所有域内计算机上登录。</p><h3 id="安全域的划分" tabindex="-1"><a class="header-anchor" href="#安全域的划分" aria-hidden="true">#</a> 安全域的划分</h3><p>划分安全域的目的是将一组安全等级相同的计算机划入同一网段。</p><p>一个典型中小型内网安全域的划分，一般分为DMZ和内网，通过硬件防火墙的不同端口实现隔离。</p><p>在一个用路由器连接的内网中，可以将网络划分为三个区域：</p><details class="custom-container details"><summary>网络区域划分</summary><p>1）安全级别最高的内网</p><p>2）安全级别中等的DMZ</p><p>3）安全级别最低的外网</p></details><p>DMZ 称为隔离区，是一个非安全系统与安全系统之间的缓冲区，位于企业内部网络和外部网络之间。</p><p>DMZ 对外提供服务，可从外部访问，放置一些必须公开的设备（Web服务器，Email服务器等）。</p><p>DMZ不能访问内网，内网能访问DMZ。</p><h3 id="域内权限" tabindex="-1"><a class="header-anchor" href="#域内权限" aria-hidden="true">#</a> 域内权限</h3><h4 id="_1-域本地组" tabindex="-1"><a class="header-anchor" href="#_1-域本地组" aria-hidden="true">#</a> 1）域本地组</h4><p>多域用户访问单域资源，可以从任何域添加账号、全局组和通用组，但只能在其所在域内指派权限。</p><p>域本地组不能嵌套在其它组中，主要用于授权本域内资源访问权限。</p><h4 id="_2-全局组" tabindex="-1"><a class="header-anchor" href="#_2-全局组" aria-hidden="true">#</a> 2）全局组</h4><p>单域用户访问多域资源，只能在创建该全局组的域中添加用户和全局组。</p><p>可以在域森林的任何域内指派权限，全局组可以嵌套在其它组中。</p><p>例如，将用户李白（域账号为LB）添加到域本地组Administrators中，并不能使LB对非DC的域成员计算机有特权。</p><p>但是将LB添加到全局组 Domain Admins 中，用户李白就成为了域管理员（可全局使用，对域成员计算机有特权）。</p><h4 id="_3-通用组" tabindex="-1"><a class="header-anchor" href="#_3-通用组" aria-hidden="true">#</a> 3）通用组</h4><p>通用组的成员来自域森林中的任何域的用户账号、全局组和其它通用组。</p><p>可以嵌套在其它组中，可在该域森林的任何域中指派权限，适合在域森林中跨域使用。</p><p>通用组的成员保存在全局编录（GC）中，全局编录用于存储一些不经常发生变化的信息。</p><p>因此建议把经常变化的用户账号先添加到全局组，再把这些相对稳定的全局组添加到通用组</p><div class="custom-container tip"><p class="custom-container-title">提示</p><p>域本地组来自全林，作用于本域</p><p>全局组来自本域，作用于全林</p><p>通用组来自全林，作用于全林</p></div><h4 id="_4-a-g-dl-p策略" tabindex="-1"><a class="header-anchor" href="#_4-a-g-dl-p策略" aria-hidden="true">#</a> 4）A-G-DL-P策略</h4><p>A-G-DL-P策略指，将用户账号添加到全局组中，将全局组添加到域本地组中，然后为域本地组分配资源权限。</p><p>A 表示用户账号（Account）</p><p>G 表示全局组（Global Group）</p><p>U 表示通用组（Universal Group）</p><p>DL 表示域本地组（Domain Local Group）</p><p>P 表示资源权限（Permission）</p><p>A-G-DL-P策略形成后，需要给一个用户添加权限时，只要把这个用户添加到某个域本地组就可以了。</p><h2 id="域环境搭建" tabindex="-1"><a class="header-anchor" href="#域环境搭建" aria-hidden="true">#</a> 域环境搭建</h2><table><thead><tr><th>主机名</th><th>操作系统</th><th>IP地址</th><th>角色</th></tr></thead><tbody><tr><td>DC01</td><td>Windows Server 2012 r2</td><td>192.168.1.199</td><td>域控制器</td></tr><tr><td>Web</td><td>Windows Server 2008 r2</td><td>192.168.1.245</td><td>域内主机</td></tr></tbody></table><h3 id="_1-更改计算机名称" tabindex="-1"><a class="header-anchor" href="#_1-更改计算机名称" aria-hidden="true">#</a> 1）更改计算机名称</h3><p>把两台电脑主机名改一下（打开计算机属性处更改）</p><p>分别改为DC01、Web</p><h3 id="_2-安装域控服务" tabindex="-1"><a class="header-anchor" href="#_2-安装域控服务" aria-hidden="true">#</a> 2）安装域控服务</h3><p>在 DC01 这台机器上打开服务器管理-添加角色和服务</p><p><img src="'+o+'" alt="" loading="lazy"></p><p><img src="'+c+'" alt="image-20230202104945935" loading="lazy"></p><h3 id="_3-升级为域控制器" tabindex="-1"><a class="header-anchor" href="#_3-升级为域控制器" aria-hidden="true">#</a> 3）升级为域控制器</h3><p>先点击提升为域控制器</p><p><img src="'+h+'" alt="" loading="lazy"></p><p>然后添加新林并设置一个根域名</p><p><img src="'+l+'" alt="" loading="lazy"></p><p>点击下一步，为DSRM设置个密码(pwd@admin.123)</p><p><img src="'+m+'" alt="" loading="lazy"></p><p>然后一路下一步就行</p><p><img src="'+_+'" alt="" loading="lazy"></p><p><img src="'+g+`" alt="" loading="lazy"></p><p>安装完重启后AD服务和DNS就都安装成功了。</p><p>DNS用来把域名解析为IP，域内主机都要把DNS服务器设置为域控的IP。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#在终端输入命令设置域管理的密码永远不要过期</span>
net accounts /maxpwage:unlimited
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-创建域用户" tabindex="-1"><a class="header-anchor" href="#_4-创建域用户" aria-hidden="true">#</a> 4）创建域用户</h3><p>打开域用户和计算机</p><p><img src="`+b+'" alt="" loading="lazy"></p><p>在根域下新建用户组</p><p><img src="'+u+'" alt="" loading="lazy"></p><p><img src="'+f+'" alt="image-20230202122157893" loading="lazy"></p><p>接着新建用户，下一步设置密码(datang@admin.1)</p><p><img src="'+D+'" alt="" loading="lazy"></p><p>然后把这个用户添加到刚建的CNSEC用户组，并设置为主要组</p><h3 id="_5-把web主机加入域内" tabindex="-1"><a class="header-anchor" href="#_5-把web主机加入域内" aria-hidden="true">#</a> 5）把Web主机加入域内</h3><p>把主机的DNS服务器地址改为域控的IP</p><p><img src="'+x+'" alt="" loading="lazy"></p><p>更改主机名处隶属于根域</p><p><img src="'+v+'" alt="" loading="lazy"></p><p><img src="'+y+`" alt="" loading="lazy"></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>net config workstation
<span class="token comment">#查看当前域信息</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-域内主机用域用户登录" tabindex="-1"><a class="header-anchor" href="#_6-域内主机用域用户登录" aria-hidden="true">#</a> 6）域内主机用域用户登录</h3><p>想要在域内主机Web这台机器上登录，需要先在Web上把域用户或者组加入到远程用户组中。</p><p><img src="`+C+'" alt="" loading="lazy"></p>',82);function L(P,k){const p=d("ExternalLinkIcon");return i(),n("div",null,[N,e("p",null,[e("a",S,[a("比如某公司使用域树abc.com"),r(p)]),a("，"),e("a",A,[a("被兼并公司使用abc.net"),r(p)]),a("，abc.net无法挂在abc.com下；")]),w])}const I=t(z,[["render",L],["__file","域环境介绍.html.vue"]]);export{I as default};
